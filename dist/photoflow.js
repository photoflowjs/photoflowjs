!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),o=i(2),r=function(){function t(){}return t._initContainer=function(t){t.style.position="relative",t.style.visibility="none",t.style.height="0px"},t._initImage=function(t){t.style.position="absolute"},t._revealContainer=function(t){t.style.visibility=""},t._positionImage=function(t,e,i,n,o){var r=t;r.style.top=i+"px",r.style.left=e+"px";var s=t;"PICTURE"===t.tagName&&(s=t.querySelector("img")),s.style.width=n+"px",s.style.height=o+"px"},t._getElementWidth=function(t){return"PICTURE"===t.tagName?t.querySelector("img").naturalWidth:"VIDEO"===t.tagName?t.videoWidth:t.naturalWidth},t._getElementHeight=function(t){return"PICTURE"===t.tagName?t.querySelector("img").naturalHeight:"VIDEO"===t.tagName?t.videoHeight:t.naturalHeight},t._setContainerHeight=function(t,e){t.style.height=e+"px"},t._getOption=function(t,e){for(var i=n.defaultOptions,o=t,r=e.split("."),s=0;s<r.length;s++){var a=r[s];void 0!==i[a]?i=i[a]:console.error("Looking up key that doesn't exist as a default option, did you mess up?"),null!=o&&(o=o[a])}return null!=o?o:i},t.init=function(e,i){t._initContainer(e);for(var n=t._getOption(i,"elementSelector")(e),r=Array.prototype.slice.call(n),s=new o.JustifiedRenderer(e,r,i),a=0;a<r.length;a++){t._initImage(r[a]);var h=r[a],l=r[a];"VIDEO"!==h.tagName?("PICTURE"===h.tagName&&(l=h.querySelector("img")),l.complete?s.imageInitialized():l.addEventListener("load",(function(){s.imageInitialized()}))):h.readyState>=1?s.imageInitialized():h.addEventListener("loadedmetadata",(function(){s.imageInitialized()}))}return window.onload=function(){s.reflow()},window.onresize=function(){s.reflow()},s},t}();e.Photoflow=r,window.Photoflow=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={border:0,margin:5,debounceResizeWidth:50,elementSelector:function(t){for(var e=Array.prototype.slice.call(t.querySelectorAll("img,video,picture")),i=[],n=0;n<e.length;n++){var o=e[n];"IMG"===o.tagName&&"PICTURE"===o.parentElement.tagName||i.push(o)}return i},justified:{targetRowHeight:"40vh",validRow:function(t,e,i,n){if(n<5)var o=t/4,r=3*t;else o=.6*t,r=2*t;return!(1!==e&&i<o)&&i<r}}};e.defaultOptions=n},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(0),s=function(t){function e(e,i,n){var o=t.call(this,e,i,n)||this;return o.targetRowHeight=0,o.isRowValid=r.Photoflow._getOption(n,"justified.validRow"),o.renderedWidth=-1,o.renderedRows=[],o.setVariableSettings(),o}return o(e,t),e.prototype.setVariableSettings=function(){this.targetRowHeight=this.getDimensionSetting("justified.targetRowHeight"),t.prototype.setVariableSettings.call(this)},e.prototype.calculateY=function(t){for(var e=this.width-(t.length-1)*this.margin-2*this.border,i=this.getRs(t),n=0,o=0;o<i.length;o++)n+=i[o];return e/n},e.prototype.emitRow=function(t,e){for(var i=this.calculateY(t),n=this.border,o=0;o<t.length;o++){var s=t[o],a=r.Photoflow._getElementWidth(t[o])/r.Photoflow._getElementHeight(t[o])*i;r.Photoflow._positionImage(s,n,e,a,i),n+=a+this.margin}return i},e.prototype.genRowKey=function(t){return t.join(",")},e.prototype.rowHeight=function(t){for(var e=[],i=0;i<t.length;i++)e.push(this.images[t[i]]);return this.calculateY(e)},e.prototype.calculateBadness=function(t){return Math.pow(Math.abs(t-this.targetRowHeight),2)},e.prototype.genValidChildren=function(t,e){for(var i=this.images.length,n=[],o=[e],r=e,s=!1,a=!1;r<i&&!s;){var h=this.rowHeight(o);if(this.isRowValid(this.targetRowHeight,o.length,h)){a=!0;var l=this.genRowKey(o);l in t||(t[l]={key:l,height:h,badness:this.calculateBadness(h),cost:1/0,terminal:o[o.length-1],bestParent:null});var u=t[l];n.push(u)}else a&&(s=!0);r++,o.push(r)}return n},e.prototype.findOptimalRows=function(){for(var t,e=this.images.length,i={key:"root",height:-1,cost:0,terminal:-1,bestParent:null},n={root:i},o=0,r=[i],s=null,a=1/0;t=r.pop();)for(var h=this.genValidChildren(n,t.terminal+1),l=0;l<h.length;l++){o++;var u=h[l];-1===r.indexOf(u)&&r.push(u),t.cost+u.badness<u.cost&&(u.cost=t.cost+u.badness,u.bestParent=t.key)}console.log("Loops: "+o);var d=Object.keys(n);for(l=0;l<d.length;l++){var c=n[d[l]];c.terminal===e-1&&c.cost<a&&(a=c.cost,s=c.key)}console.log("Best cost: "+a);for(var g=[],f=n[s];f;)"root"!==f.key&&g.push(f.key),f=n[f.bestParent];return g.reverse()},e.prototype.explodeRows=function(t){for(var e=[],i=0;i<t.length;i++){for(var n=[],o=t[i].split(","),r=0;r<o.length;r++)n.push(this.images[parseInt(o[r])]);e.push(n)}return e},e.prototype.getRs=function(t){for(var e=[],i=0;i<t.length;i++)e.push(r.Photoflow._getElementWidth(t[i])/r.Photoflow._getElementHeight(t[i]));return e},e.prototype.doFlow=function(){var t=[],e=!1;-1!==this.renderedWidth&&Math.abs(this.renderedWidth-this.width)<this.debounceResizeWidth?t=this.renderedRows:(t=this.findOptimalRows(),e=!0);for(var i=this.explodeRows(t),n=this.border,o=0;o<i.length;o++){n+=this.emitRow(i[o],n)+this.margin}r.Photoflow._setContainerHeight(this.container,n+this.border),r.Photoflow._revealContainer(this.container),e&&(this.renderedWidth=this.width,this.renderedRows=t)},e}(i(3).AbstractRenderer);e.JustifiedRenderer=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),o=function(){function t(t,e,i){this.container=t,this.images=e,this.userOptions=i,this.width=0,this.height=0,this.border=0,this.margin=0,this.initializedImages=0,this.hasRendered=!1,this.setVariableSettings(),this.debounceResizeWidth=0,this.hasRendered=!1,this.onready=null,this.onresize=null}return t.prototype.getDimensionSetting=function(t){var e=n.Photoflow._getOption(this.userOptions,t);if("number"==typeof e)return e;if("string"!=typeof e)return console.error("Unsupported dimension type"),0;var i=parseInt(e);if(!isNaN(e)&&!isNaN(i))return i;var o=parseInt(e.slice(0,e.length-2)),r=e.slice(-2);return-1===["px","vh","vw"].indexOf(r)||isNaN(o)?(console.error("Unsupported dimension type, use 'px', 'vh' or 'vw'"),0):"px"===r?o:"vh"===r?(console.log(window.innerHeight*(o/100)),window.innerHeight*(o/100)):"vw"===r?window.innerWidth*(o/100):0},t.prototype.setVariableSettings=function(){this.border=this.getDimensionSetting("border"),this.margin=this.getDimensionSetting("margin"),this.debounceResizeWidth=this.getDimensionSetting.call(this,"debounceResizeWidth")},t.prototype.reflow=function(){if(this.initializedImages===this.images.length){this.setVariableSettings();var t=this.width,e=this.container.offsetWidth,i=this.container.offsetHeight,n=!1,o=!1;this.width!==e&&0!==e&&(n=!0),this.height!==i&&0!==i&&(o=!0),this.width=e,this.height=i,(n||o)&&(this.doFlow(),this.hasRendered||(this.hasRendered=!0,this.ready()),0!==t&&this.resize())}},t.prototype.imageInitialized=function(){this.initializedImages++,this.initializedImages===this.images.length&&this.reflow()},t.prototype.ready=function(){this.onready&&this.onready(this)},t.prototype.resize=function(){this.onresize&&this.onresize(this)},t}();e.AbstractRenderer=o}]);
//# sourceMappingURL=photoflow.js.map