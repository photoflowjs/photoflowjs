!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),r=function(){function e(){}return e.initContainer=function(e){e.style.position="relative",e.style.visibility="none",e.style.height="0px"},e.initImage=function(e){e.style.position="absolute"},e.revealContainer=function(e){e.style.visibility=""},e.positionImage=function(e,t,i,n,r){var o=e;o.style.top=i+"px",o.style.left=t+"px";var s=e;"PICTURE"===e.tagName&&(s=e.querySelector("img")),s.style.width=n+"px",s.style.height=r+"px"},e.getElementWidth=function(e){if("PICTURE"===e.tagName){var t=e.querySelector("img");return null===t?0:t.naturalWidth}return"VIDEO"===e.tagName?e.videoWidth:e.naturalWidth},e.getElementHeight=function(e){if("PICTURE"===e.tagName){var t=e.querySelector("img");return null===t?0:t.naturalHeight}return"VIDEO"===e.tagName?e.videoHeight:e.naturalHeight},e.setContainerHeight=function(e,t){e.style.height=t+"px"},e.getOption=function(e,t){for(var i=n.defaultOptions,r=e,o=t.split("."),s=0;s<o.length;s++){var a=o[s];void 0!==i[a]?i=i[a]:console.error("Looking up key that doesn't exist as a default option, did you mess up?"),null!=r&&(r=r[a])}return null!=r?r:i},e}();t.PhotoflowHelpers=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),r=i(0),o=function(){function e(){}return e.init=function(e,t){r.PhotoflowHelpers.initContainer(e);for(var i=r.PhotoflowHelpers.getOption(t,"elementSelector")(e),o=Array.prototype.slice.call(i),s=new n.JustifiedRenderer(e,o,t),a=0;a<o.length;a++){r.PhotoflowHelpers.initImage(o[a]);var l=o[a],h=o[a];"VIDEO"!==l.tagName?("PICTURE"===l.tagName&&(h=l.querySelector("img")),h.complete?s.imageInitialized():h.addEventListener("load",(function(){s.imageInitialized()}))):l.readyState>=1?s.imageInitialized():l.addEventListener("loadedmetadata",(function(){s.imageInitialized()}))}return window.onload=function(){s.reflow()},window.onresize=function(){s.reflow()},s},e}();t.Photoflow=o,window.Photoflow=o},function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(e){function t(t,i,n){var r=e.call(this,t,i,n)||this;return r.targetRowHeight=0,r.isRowValid=o.PhotoflowHelpers.getOption(n,"justified.validRow"),r.renderedWidth=-1,r.renderedRows=[],r.setVariableSettings(),r}return r(t,e),t.prototype.setVariableSettings=function(){this.targetRowHeight=this.getDimensionSetting("justified.targetRowHeight"),e.prototype.setVariableSettings.call(this)},t.prototype.calculateY=function(e){for(var t=this.width-(e.length-1)*this.margin-2*this.border,i=this.getRs(e),n=0,r=0;r<i.length;r++)n+=i[r];return t/n},t.prototype.emitRow=function(e,t){for(var i=this.calculateY(e),n=this.border,r=0;r<e.length;r++){var s=e[r],a=o.PhotoflowHelpers.getElementWidth(e[r])/o.PhotoflowHelpers.getElementHeight(e[r])*i;o.PhotoflowHelpers.positionImage(s,n,t,a,i),n+=a+this.margin}return i},t.prototype.genRowKey=function(e){return e.join(",")},t.prototype.rowHeight=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.images[e[i]]);return this.calculateY(t)},t.prototype.calculateBadness=function(e){return Math.pow(Math.abs(e-this.targetRowHeight),2)},t.prototype.genValidChildren=function(e,t){for(var i=this.images.length,n=[],r=[t],o=t,s=!1,a=!1;o<i&&!s;){var l=this.rowHeight(r);if(this.isRowValid(this.targetRowHeight,r.length,l)){a=!0;var h=this.genRowKey(r);h in e||(e[h]={key:h,height:l,badness:this.calculateBadness(l),cost:1/0,terminal:r[r.length-1],bestParentKey:null});var u=e[h];n.push(u)}else a&&(s=!0);o++,r.push(o)}return n},t.prototype.findOptimalRows=function(){for(var e,t=this.images.length,i={key:"root",height:-1,cost:0,badness:0,terminal:-1,bestParentKey:null},n={root:i},r=0,o=[i],s=null,a=1/0;e=o.pop();)for(var l=this.genValidChildren(n,e.terminal+1),h=0;h<l.length;h++){r++;var u=l[h];-1===o.indexOf(u)&&o.push(u),e.cost+u.badness<u.cost&&(u.cost=e.cost+u.badness,u.bestParentKey=e.key)}console.log("Loops: "+r);var d=Object.keys(n);for(h=0;h<d.length;h++){var f=n[d[h]];f.terminal===t-1&&f.cost<a&&(a=f.cost,s=f.key)}console.log("Best cost: "+a);for(var c=[],p=n[s];p;)"root"!==p.key&&c.push(p.key),p=n[p.bestParentKey];return c.reverse()},t.prototype.explodeRows=function(e){for(var t=[],i=0;i<e.length;i++){for(var n=[],r=e[i].split(","),o=0;o<r.length;o++)n.push(this.images[parseInt(r[o])]);t.push(n)}return t},t.prototype.getRs=function(e){for(var t=[],i=0;i<e.length;i++)t.push(o.PhotoflowHelpers.getElementWidth(e[i])/o.PhotoflowHelpers.getElementHeight(e[i]));return t},t.prototype.doFlow=function(){var e=[],t=!1;-1!==this.renderedWidth&&Math.abs(this.renderedWidth-this.width)<this.debounceResizeWidth?e=this.renderedRows:(e=this.findOptimalRows(),t=!0);for(var i=this.explodeRows(e),n=this.border,r=0;r<i.length;r++){n+=this.emitRow(i[r],n)+this.margin}o.PhotoflowHelpers.setContainerHeight(this.container,n+this.border),o.PhotoflowHelpers.revealContainer(this.container),t&&(this.renderedWidth=this.width,this.renderedRows=e)},t}(i(4).AbstractRenderer);t.JustifiedRenderer=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={border:0,margin:5,debounceResizeWidth:50,elementSelector:function(e){for(var t=Array.prototype.slice.call(e.querySelectorAll("img,video,picture")),i=[],n=0;n<t.length;n++){var r=t[n];"IMG"===r.tagName&&"PICTURE"===r.parentElement.tagName||i.push(r)}return i},justified:{targetRowHeight:"40vh",validRow:function(e,t,i,n){if(n<5)var r=e/4,o=3*e;else r=.6*e,o=2*e;return!(1!==t&&i<r)&&i<o}}};t.defaultOptions=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),r=function(){function e(e,t,i){this.container=e,this.images=t,this.userOptions=i,this.width=0,this.height=0,this.border=0,this.margin=0,this.initializedImages=0,this.hasRendered=!1,this.setVariableSettings(),this.debounceResizeWidth=0,this.hasRendered=!1,this.onready=null,this.onresize=null}return e.prototype.getDimensionSetting=function(e){var t=n.PhotoflowHelpers.getOption(this.userOptions,e);if("number"==typeof t)return t;if("string"!=typeof t)return console.error("Unsupported dimension type"),0;var i=parseInt(t);if(!isNaN(t)&&!isNaN(i))return i;var r=parseInt(t.slice(0,t.length-2)),o=t.slice(-2);return-1===["px","vh","vw"].indexOf(o)||isNaN(r)?(console.error("Unsupported dimension type, use 'px', 'vh' or 'vw'"),0):"px"===o?r:"vh"===o?(console.log(window.innerHeight*(r/100)),window.innerHeight*(r/100)):"vw"===o?window.innerWidth*(r/100):0},e.prototype.setVariableSettings=function(){this.border=this.getDimensionSetting("border"),this.margin=this.getDimensionSetting("margin"),this.debounceResizeWidth=this.getDimensionSetting.call(this,"debounceResizeWidth")},e.prototype.reflow=function(){if(this.initializedImages===this.images.length){this.setVariableSettings();var e=this.width,t=this.container.offsetWidth,i=this.container.offsetHeight,n=!1,r=!1;this.width!==t&&0!==t&&(n=!0),this.height!==i&&0!==i&&(r=!0),this.width=t,this.height=i,(n||r)&&(this.doFlow(),this.hasRendered||(this.hasRendered=!0,this.ready()),0!==e&&this.resize())}},e.prototype.imageInitialized=function(){this.initializedImages++,this.initializedImages===this.images.length&&this.reflow()},e.prototype.ready=function(){this.onready&&this.onready(this)},e.prototype.resize=function(){this.onresize&&this.onresize(this)},e}();t.AbstractRenderer=r}]);
//# sourceMappingURL=photoflow.js.map